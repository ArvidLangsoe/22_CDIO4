$(document).ready(function(){showLoginPage();$(document).on("click",".logout_link",function(a){a.preventDefault();showLoginPage()});$(document).on("submit","#login_form",function(a){a.preventDefault();userLogin($(this).serializeJSON()).done(function(b){onLoginShowPage(b)}).fail(function(b){console.log("Fejl i Login REST")})});$(document).on("submit","#login_new_pass_form",function(b){b.preventDefault();$('input[name="repeat_password"]').prop("disabled",true);var a=$('input[name="id"]').val();userLoginNewPass($(this).serializeJSON()).done(function(c){showRestMessage(c,function(){return showFullPage(a)})}).fail(function(c){console.log("Fejl i Login REST")})})});function showFullPage(a){getUser(a).done(function(b){$.get("src/html/master.html",function(c){$("#login").remove();$("body").append(Mustache.render(c,b));showStartPage();$("#user_dropdown_menu .user_edit_link").show();switch(b.role){case"Admin":$(".top_nav_role").addClass("role_admin");getRoleTemplate("src/html/role_privilege/admin_privilege.html");break;case"Farmaceut":$(".top_nav_role").addClass("role_pharmacist");getRoleTemplate("src/html/role_privilege/pharmacist_privilege.html").done(function(){getRoleTemplate("src/html/role_privilege/foreman_privilege.html").done(function(){getRoleTemplate("src/html/role_privilege/labtech_privilege.html")})});break;case"Værkfører":$(".top_nav_role").addClass("role_foreman");getRoleTemplate("src/html/role_privilege/foreman_privilege.html").done(function(){getRoleTemplate("src/html/role_privilege/labtech_privilege.html")});break;case"Laborant":$(".top_nav_role").addClass("role_labtech");getRoleTemplate("src/html/role_privilege/labtech_privilege.html");default:break}})}).fail(function(b){console.log("Fejl i User REST")})}function onLoginShowPage(c){var a=c.split(": ");var b=$('#login_form input[name="id"]').val();$("#login .alert").remove();switch(a[0]){case"super_login":$.get("src/html/master.html",function(d){$("body").html(d);$("#user_dropdown_menu .user_edit_link").hide();$(".top_nav_role").addClass("role_super");$(".role_super").text("Super");$(".top_nav_name").text("admin");$(".top_nav_userid").text("");showStartPage();getRoleTemplate("src/html/role_privilege/admin_privilege.html").done(function(){getRoleTemplate("src/html/role_privilege/pharmacist_privilege.html").done(function(){getRoleTemplate("src/html/role_privilege/foreman_privilege.html").done(function(){getRoleTemplate("src/html/role_privilege/labtech_privilege.html")})})})});break;case"new_login":showNewLoginPage(b);break;case"true_login":showFullPage(b);break;default:$("#login").find(".form-group:last").prepend('<div class="alert alert-danger" role="alert">'+a[1]+"</div>")}}function showLoginPage(){$.get("src/html/login.html",function(a){$("body").html(a);$('#login_form input[name="id"]').focus()})}function showNewLoginPage(a){$.get("src/html/login_new_pass.html",function(b){$("body").html(b);$('#login_new_pass_form input[name="id"]').val(a);validateLoginNewPass()})}function getRoleTemplate(a){return $.get(a,function(b){$("#side_panel > #side_nav > ul").append(b)})}function userLogin(a){return $.ajax({url:"rest/login/user",type:"POST",contentType:"application/json",data:a})}function userLoginNewPass(a){return $.ajax({url:"rest/login/new_password",type:"PUT",contentType:"application/json",data:a})}function resetPassword(a){return $.ajax({url:"rest/login/reset_password",type:"POST",contentType:"application/json",data:a})}function changePassword(a){return $.ajax({url:"rest/login/change_password",type:"POST",contentType:"application/json",data:a})}$(document).ready(function(){$(".user_dropdown").dropdown();$("#alert_container").alert();$(document).on("click","#logo a",function(a){a.preventDefault();showStartPage()});$(document).on("click",".startpage_link",function(b){b.preventDefault();var a=$('input[name="id"]').text();showStartPage(a)})});function showStartPage(){var a={id:$(".top_nav_userid").text(),name:$(".top_nav_name").text(),role:$(".top_nav_role").text()};$.get("src/html/start.html",function(b){$("#content").html(Mustache.render(b,a))})}function showRestMessage(f,e){var d=f.split(": ");var a={notification:d[0],message:d[1],cssClass:"danger"};switch(a.notification){case"success":a.cssClass="success";e();showAlertMessage(a);break;case"collision-error":var h=$('[name="rawMaterialId"]');var g=$('[name="rbId"]');var c=$('[name="pbId"]');var b=$('[name="recipeId"]');var i=$('[name="id"]');h.parent().removeClass("has-success").addClass("has-danger");h.removeClass("form-control-success").addClass("form-control-danger").attr("aria-invalid","true");g.parent().removeClass("has-success").addClass("has-danger");g.removeClass("form-control-success").addClass("form-control-danger").attr("aria-invalid","true");c.parent().removeClass("has-success").addClass("has-danger");c.removeClass("form-control-success").addClass("form-control-danger").attr("aria-invalid","true");if($("#recipe_comp_edit_form").length<1&&$("#recipe_component_create_form").length<1){console.log("edit: "+$("#recipe_comp_edit_form").length);console.log("create: "+$("#recipe_component_create_form").length);console.log("hey");b.parent().removeClass("has-success").addClass("has-danger");b.removeClass("form-control-success").addClass("form-control-danger").attr("aria-invalid","true")}i.parent().removeClass("has-success").addClass("has-danger");i.removeClass("form-control-success").addClass("form-control-danger").attr("aria-invalid","true");showAlertMessage(a);break;default:if($("#login_new_pass_form").length>0){$('input[name="repeat_password"]').prop("disabled",false);$("#login .alert").remove();$("#login_new_pass_form").find(".form-group:last").prepend('<div class="alert alert-danger" role="alert">'+a.message+"</div>")}else{showAlertMessage(a)}}}function showAlertMessage(a){$.get("src/html/alert.html",function(b){$("#alert_container").remove();$("body").append(Mustache.render(b,a));if($("#alert_container").width()>500){$("#alert_container").css("margin-left","-"+$("#alert_container").width()/2)}$("#alert_container").fadeIn("slow",function(){$(this).delay(10000).fadeOut("slow",function(){$(this).remove()})})})}$.validator.addMethod("validCPR",function checkCPR(e){if(e.search(/\d\d\d\d\d\d\d\d\d\d/)<-1){return false}splitCPR=e.split("",2);if(parseInt(splitCPR[0])>31){return false}if(parseInt(splitCPR[1])>12){return false}splitCPR=e.split("");var c=0;var a=[4,3,2,7,6,5,4,3,2];var d=parseInt(splitCPR[9]);for(var b=0;b<9;b++){c+=parseInt(splitCPR[b])*a[b]}if(11-(c%11)==d){return true}else{return false}},"Indtast et gyldigt CPR-nummer.");$.validator.addMethod("validID",function validID(a){if(a>=1&&a<=99999999&&a%1==0){return true}else{return false}},"Indtast et id mellem 1 og 99999999.");$.validator.addMethod("validPassword",function checkPassword(b){var a=0;if(b.length<6){return false}if(b.search(/[A-Z]/)>-1){a++}if(b.search(/[a-z]/)>-1){a++}if(b.search(/[0-9]/)>-1){a++}if(b.search(/[-._+!?=]/)>-1){a++}if(a>=3){return true}else{return false}},"Passwordet skal indeholde små og store bogstaver samt tal.");$.validator.addMethod("validNetto",function checkNetto(a){if(a>=0.05&&a<=20){return true}else{return false}},"Nominel netto skal være mellem 0.05 kg og 20 kg.");$.validator.addMethod("validTolerance",function checkTolerance(a){if(a>=0.1&&a<=10){return true}else{return false}},"Tolerance skal være mellem 0.1 % og 10 %.");$.validator.setDefaults({errorElement:"div",errorPlacement:function(b,a){b.addClass("form-control-feedback");b.insertAfter(a)},highlight:function(a){$(a).parent().removeClass("has-success").addClass("has-danger");$(a).parent().find("input").removeClass("form-control-success").addClass("form-control-danger")},unhighlight:function(a){$(a).parent().removeClass("has-danger").addClass("has-success");$(a).parent().find("input").removeClass("form-control-danger").addClass("form-control-success")}});function validateLoginNewPass(){$("#login_new_pass_form").validate({rules:{password:{required:true,validPassword:true},repeat_password:{required:true,equalTo:function(a){if($("#password").val()!=""){return"#password"}else{return false}}}}})}function validateUser(a){$(a).validate({rules:{id:{required:true,validID:true},name:{required:true,minlength:2,maxlength:20},ini:{required:true,minlength:2,maxlength:4},cpr:{required:true,validCPR:true},role:{required:true}}})}function validateRawMaterial(a){$(a).validate({rules:{id:{required:true,validID:true},name:{required:true,minlength:2,maxlength:20},supplier:{required:true,minlength:2,maxlength:20}}})}function validateRecipe(a){$(a).validate({rules:{recipeId:{required:true,validID:true},recipeName:{required:true,minlength:2,maxlength:20}}})}function validateRecipeComp(a){$(a).validate({rules:{recipeId:{required:true,validID:true},rawMaterialId:{required:true,validID:true},nomNetto:{required:true,validNetto:true},tolerance:{required:true,validTolerance:true}}})}function validateRawMaterialBatch(a){$(a).validate({rules:{rbId:{required:true,validID:true},rawMaterialId:{required:true,validID:true},amount:{required:true,number:true,min:0}}})}function validateProductBatch(a){$(a).validate({rules:{pbId:{required:true,validID:true},recipeId:{required:true,validID:true}}})}$(document).ready(function(){$(document).on("click",".product_batch_list_link",function(a){a.preventDefault();showProductBatchListPage()});$(document).on("click",".product_batch_create_link",function(a){a.preventDefault();getRecipeList().done(function(b){$.get("src/html/product_batch/product_batch_create.html",function(c){$("#content").html(c);$.each(b,function(d,e){$(".custom-select").append(Mustache.render('<option value="'+e.recipeId+'">'+e.recipeId+" ("+e.recipeName+")</option>",e))});validateProductBatch("#product_batch_create_form")})}).fail(function(b){console.log("Fejl i Recipe REST")})});$(document).on("click",".product_batch_edit_table_link",function(b){b.preventDefault();var a=$(this).parents("tr").children("td:first").text();getProductBatch(a).done(function(d){var c=d.status;$.get("src/html/product_batch/product_batch_edit.html",function(e){$("#content").html(Mustache.render($(e).html(),d));$(".pb_status").text(pbStatusCodeToText(d.status));getRecipe(""+d.recipeId).done(function(f){$('input[name="recipeName"]').val(f.recipeName)}).fail(function(f){console.log("Fejl i Recipe REST")});showProductBatchCompsPage(a);$(".pb_status").addClass("status_"+c)})}).fail(function(c){console.log("Fejl i ProductBatch REST")})});$(document).on("submit","#product_batch_create_form",function(a){a.preventDefault();createProductBatch($(this).serializeJSON()).done(function(b){showRestMessage(b,function(){return showProductBatchListPage()})}).fail(function(b){console.log("Fejl i ProductBatch REST")})})});function showProductBatchListPage(){getProductBatchList().done(function(a){$.get("src/html/product_batch/product_batch_list.html",function(b){$("#content").html(b);$.each(a,function(c,d){d.statusText=pbStatusCodeToText(d.status);$.get("src/html/product_batch/product_batch_list_row.html",function(e){$("#product_batch_list .table tbody").append(Mustache.render($(e).html(),d))})})})}).fail(function(a){console.log("Fejl i ProductBatch REST")})}function showProductBatchCompsPage(a){getProductBatchCompListSpecific(a).done(function(b){$.get("src/html/product_batch/product_batch_comp_list.html",function(c){$("#product_batch_edit_form").append(c);if(b.length>0){$("#product_batch_comp_list .product_batch_comp_list_table").html('<table class="table table-hover"><thead><tr><th>Produkt batch id</th><th>Råvare batch id</th><th>Tara</th><th>Netto</th><th>Bruger id</th></tr></thead><tbody></tbody></table>');$.each(b,function(d,e){$.get("src/html/product_batch/product_batch_comp_list_row.html",function(f){$("#product_batch_comp_list .table tbody").append(Mustache.render($(f).html(),e))})})}})})}function pbStatusCodeToText(a){var b;switch(a){case 0:b="Ikke påbegyndt";break;case 1:b="Under produktion";break;case 2:b="Afsluttet";break;default:console.log("Fejl i status kode");break}return b}function createProductBatch(a){return $.ajax({url:"rest/product_batch/create",type:"POST",contentType:"application/json",data:a})}function getProductBatch(a){return $.ajax({url:"rest/product_batch/read",type:"POST",data:a,contentType:"application/json"})}function getProductBatchList(){return $.ajax({url:"rest/product_batch/read_list",type:"GET",contentType:"application/json"})}function getProductBatchCompListSpecific(a){return $.ajax({url:"rest/product_batch_comp/read_list_specific",type:"POST",data:a,contentType:"application/json"})}$(document).ready(function(){$(document).on("click",".raw_material_batch_list_link",function(a){a.preventDefault();showRawMaterialBatchListPage()});$(document).on("click",".raw_material_batch_create_link",function(a){a.preventDefault();getRawMaterialList().done(function(b){$.get("src/html/raw_material_batch/raw_material_batch_create.html",function(c){$("#content").html(c);$.each(b,function(d,e){$(".custom-select").append(Mustache.render('<option value="'+e.id+'">'+e.id+" ("+e.name+")</option>",e))});validateRawMaterialBatch("#raw_material_batch_create_form")})}).fail(function(b){console.log("Fejl i Recipe REST")})});$(document).on("click",".raw_material_batch_edit_table_link",function(b){b.preventDefault();var a=$(this).parents("tr").children("td:first").text();getRawMaterialBatch(a).done(function(c){$.get("src/html/raw_material_batch/raw_material_batch_edit.html",function(d){$("#content").html(Mustache.render($(d).html(),c));getRawMaterial(""+c.rawMaterialId).done(function(e){$('input[name="rawMaterialName"]').val(e.name)}).fail(function(e){console.log("Fejl i RawMaterial REST")});validateRawMaterialBatch("#raw_material_batch_edit_form")})}).fail(function(c){console.log("Fejl i REST")})});$(document).on("submit","#raw_material_batch_create_form",function(a){a.preventDefault();createRawMaterialBatch($(this).serializeJSON()).done(function(b){showRestMessage(b,function(){return showRawMaterialBatchListPage()})}).fail(function(b){console.log("Fejl i REST")})});$(document).on("submit","#raw_material_batch_edit_form",function(a){a.preventDefault();$('input[name="rawMaterialName"]').prop("disabled",true);updateRawMaterialBatch($(this).serializeJSON()).done(function(b){showRestMessage(b,function(){showRawMaterialBatchListPage()})}).fail(function(b){console.log("Fejl i REST")})})});function showRawMaterialBatchListPage(){getRawMaterialBatchList().done(function(a){$.get("src/html/raw_material_batch/raw_material_batch_list.html",function(b){$("#content").html(b);$.each(a,function(c,d){$.get("src/html/raw_material_batch/raw_material_batch_list_row.html",function(e){$("#raw_material_batch_list .table tbody").append(Mustache.render($(e).html(),d))})})})}).fail(function(a){console.log("Fejl!")})}function createRawMaterialBatch(a){return $.ajax({url:"rest/raw_material_batch/create",type:"POST",contentType:"application/json",data:a})}function updateRawMaterialBatch(a){return $.ajax({url:"rest/raw_material_batch/update",type:"PUT",contentType:"application/json",data:a})}function getRawMaterialBatch(a){return $.ajax({url:"rest/raw_material_batch/read",type:"POST",data:a,contentType:"application/json"})}function getRawMaterialBatchList(){return $.ajax({url:"rest/raw_material_batch/read_list",type:"GET",contentType:"application/json"})}function getRawMaterialBatchListSpecific(a){return $.ajax({url:"rest/raw_material_batch/read_list_specific",type:"POST",data:a,contentType:"application/json"})}$(document).ready(function(){$(document).on("click",".recipe_list_link",function(a){a.preventDefault();showRecipeListPage()});$(document).on("click",".recipe_create_link",function(a){a.preventDefault();$.get("src/html/recipe/recipe_create.html",function(b){$("#content").html(b);validateRecipe("#recipe_create_form")})});$(document).on("click",".recipe_edit_table_link",function(b){b.preventDefault();var a=$(this).parents("tr").children("td:first").text();showRecipeEditPage(a)});$(document).on("click",".recipe_edit_back_link",function(b){b.preventDefault();var a=$('input[name="recipeId"]').val();showRecipeEditPage(a)});$(document).on("click",".recipe_comp_edit_table_link",function(c){c.preventDefault();var b=$('input[name="recipeId"]').val();var a=$(this).parents("tr").children("td:first").text();getRecipeComp(b,a).done(function(d){$.get("src/html/recipe/recipe_comp_edit.html",function(e){$("#content").html(Mustache.render($(e).html(),d));getRawMaterial(a).done(function(f){$('input[name="rawMaterialName"]').val(f.name)}).fail(function(f){console.log("Fejl i RawMaterial REST")});validateRecipeComp("#recipe_comp_edit_form")})}).fail(function(d){console.log(d)})});$(document).on("click",".recipe_comp_create_link",function(b){b.preventDefault();var a=$('#recipe_edit_form input[name="recipeId"]').val();getRawMaterialList().done(function(c){$.get("src/html/recipe/recipe_component_create.html",function(d){$("#content").html(d);$('#recipe_component_create_form input[name="recipeId"]').val(a);$.each(c,function(e,f){$(".custom-select").append(Mustache.render('<option value="'+f.id+'">'+f.id+" ("+f.name+")</option>",f))});validateRecipeComp("#recipe_component_create_form")})}).fail(function(c){console.log("Fejl i Recipe REST")})});$(document).on("submit","#recipe_create_form",function(b){b.preventDefault();var a=$('input[name="recipeId"]').val();createRecipe($(this).serializeJSON()).done(function(c){showRestMessage(c,function(){return showRecipeEditPage(a)})}).fail(function(c){console.log("Fejl i Recipe REST")})});$(document).on("submit","#recipe_comp_edit_form",function(b){b.preventDefault();var a=$('input[name="recipeId"]').val();$('input[name="rawMaterialName"]').prop("disabled",true);updateRecipeComp($(this).serializeJSON()).done(function(c){showRestMessage(c,function(){return showRecipeEditPage(a)})}).fail(function(c){console.log("Fejl i RecipeComp REST")})});$(document).on("submit","#recipe_component_create_form",function(b){b.preventDefault();var a=$('input[name="recipeId"]').val();createRecipeComp($(this).serializeJSON()).done(function(c){showRestMessage(c,function(){return showRecipeEditPage(a)})})})});function showRecipeListPage(){getRecipeList().done(function(a){$.get("src/html/recipe/recipe_list.html",function(b){$("#content").html(b);$.each(a,function(c,d){$.get("src/html/recipe/recipe_list_row.html",function(e){$("#recipe_list .table tbody").append(Mustache.render($(e).html(),d))})})})}).fail(function(a){console.log("Fejl i Recipe REST")})}function showRecipeCompsPage(a){getRecipeCompList(a).done(function(b){$.get("src/html/recipe/recipe_comp_list.html",function(c){$("#recipe_edit_form").append(c);if(b.length>0){$("#recipe_comp_list .recipe_comp_list_table").html('<table class="table table-hover"><thead><tr><th>Råvare id</th><th>Nominel netto (kg)</th><th>Tolerance (%)</th><th></th></tr></thead><tbody></tbody></table>');$.each(b,function(d,e){$.get("src/html/recipe/recipe_comp_list_row.html",function(f){$("#recipe_comp_list .table tbody").append(Mustache.render($(f).html(),e))})})}})})}function showRecipeEditPage(a){getRecipe(a).done(function(b){$.get("src/html/recipe/recipe_edit.html",function(c){$("#content").html(Mustache.render($(c).html(),b));showRecipeCompsPage(a)})}).fail(function(b){console.log("Fejl i Recipe Comp REST")})}function getRecipeCompList(a){return $.ajax({url:"rest/recipe_component/read_list_specific",type:"POST",data:a,contentType:"application/json"})}function getRecipeComp(b,a){var c=JSON.stringify({recipeId:b,rawMaterialId:a});return $.ajax({url:"rest/recipe_component/read",type:"POST",contentType:"application/json",data:c})}function createRecipeComp(a){return $.ajax({url:"rest/recipe_component/create",type:"POST",contentType:"application/json",data:a})}function updateRecipeComp(a){return $.ajax({url:"rest/recipe_component/update",type:"PUT",contentType:"application/json",data:a})}function createRecipe(a){return $.ajax({url:"rest/recipe/create",type:"POST",contentType:"application/json",data:a})}function getRecipeList(){return $.ajax({url:"rest/recipe/read_list",type:"GET",contentType:"application/json"})}function getRecipe(a){return $.ajax({url:"rest/recipe/read",type:"POST",data:a,contentType:"application/json"})}$(document).ready(function(){$(document).on("click",".raw_material_list_link",function(a){a.preventDefault();showRawMaterialListPage()});$(document).on("click",".raw_material_create_link",function(a){a.preventDefault();$.get("src/html/raw_material/raw_material_create.html",function(b){$("#content").html(b);validateRawMaterial("#raw_material_create_form")})});$(document).on("click",".raw_material_edit_table_link",function(b){b.preventDefault();var a=$(this).parents("tr").children("td:first").text();getRawMaterial(a).done(function(c){$.get("src/html/raw_material/raw_material_edit.html",function(d){$("#content").html(Mustache.render($(d).html(),c));validateRawMaterial("#raw_material_edit_form")})}).fail(function(c){console.log("Fejl i RawMaterial REST")})});$(document).on("submit","#raw_material_create_form",function(a){a.preventDefault();createRawMaterial($(this).serializeJSON()).done(function(b){showRestMessage(b,function(){return showRawMaterialListPage()})}).fail(function(b){console.log("Fejl i RawMaterial REST")})});$(document).on("submit","#raw_material_edit_form",function(a){a.preventDefault();updateRawMaterial($(this).serializeJSON()).done(function(b){showRestMessage(b,function(){return showRawMaterialListPage()})}).fail(function(b){console.log("Fejl i RawMaterial REST")})})});function showRawMaterialListPage(){getRawMaterialList().done(function(a){$.get("src/html/raw_material/raw_material_list.html",function(b){$("#content").html(b);$.each(a,function(c,d){$.get("src/html/raw_material/raw_material_list_row.html",function(e){$("#raw_material_list .table tbody").append(Mustache.render($(e).html(),d))})})})}).fail(function(a){console.log("Fejl i RawMaterial REST")})}function createRawMaterial(a){return $.ajax({url:"rest/raw_material/create",type:"POST",contentType:"application/json",data:a})}function updateRawMaterial(a){return $.ajax({url:"rest/raw_material/update",type:"PUT",contentType:"application/json",data:a})}function getRawMaterialList(){return $.ajax({url:"rest/raw_material/read_list",type:"GET",contentType:"application/json"})}function getRawMaterial(a){return $.ajax({url:"rest/raw_material/read",type:"POST",data:a,contentType:"application/json"})}$(document).ready(function(){$(document).on("click",".user_edit_link",function(b){b.preventDefault();var a=$(".top_nav_userid").text();getUser(a).done(function(c){$.get("src/html/user/user_edit.html",function(d){$("#content").html(Mustache.render($(d).html(),c));showInitials();validateUser("#user_edit_form")})}).fail(function(c){console.log("Fejl i User REST")})});$(document).on("click",".user_list_link",function(a){a.preventDefault();showUserListPage()});$(document).on("click",".user_create_link",function(a){a.preventDefault();$.get("src/html/user/user_create.html",function(b){$("#content").html(b);showInitials();validateUser("#user_create_form")})});$(document).on("click",".user_edit_table_link",function(b){b.preventDefault();var a=$(this).parents("tr").children("td:first").text();showUserEditAdminPage(a)});$(document).on("click",".user_edit_admin_reset_pw_link",function(b){b.preventDefault();var a=$('input[name="id"]').val();resetPassword(a).done(function(c){showRestMessage(c,function(){return showUserListPage()})}).fail(function(c){console.log("Fejl i User REST")})});$(document).on("submit","#user_create_form",function(a){a.preventDefault();createUser($(this).serializeJSON()).done(function(b){showRestMessage(b,function(){return showUserListPage()})}).fail(function(b){console.log("Fejl i User REST")})});$(document).on("submit","#user_edit_form",function(a){a.preventDefault();updateUser($(this).serializeJSON()).done(function(b){showRestMessage(b,function(){return showStartPage()})}).fail(function(b){console.log("Fejl i User REST")})});$(document).on("submit","#user_edit_admin_form",function(a){a.preventDefault();updateUser($(this).serializeJSON()).done(function(b){showRestMessage(b,function(){return showUserListPage()})}).fail(function(b){console.log("Fejl i User REST")})});$(document).on("submit","#user_edit_password_form",function(c){c.preventDefault();var b=$('#user_edit_password_form input[name="id"]').val();var a=$('#user_edit_password_form input[name="password"]');$("#password-error").remove();changePassword($(this).serializeJSON()).done(function(e){var d=e.split(": ");switch(d[0]){case"success":showNewLoginPage(b);default:a.parent().append('<div id="password-error" class="error form-control-feedback">Forkert password.</div>');a.addClass("form-control-danger");a.parent().addClass("has-danger");console.log(d[1])}}).fail(function(d){console.log("Fejl i User REST")})})});function showInitials(){$('input[name="ini"]').focus(function(){var b=$(this).val();var a=generateInitials($('input[name="name"]').val());if(b==""){$(this).val(a)}})}function showUserEditAdminPage(a){getUser(a).done(function(b){$.get("src/html/user/user_edit_admin.html",function(c){$("#content").html(Mustache.render($(c).html(),b));$(".custom-select").find('option[value="'+b.role+'"]').attr("selected",true);showInitials();validateUser("#user_edit_admin_form")})}).fail(function(b){console.log("Fejl i User REST")})}function showUserListPage(){getUserList().done(function(a){$.get("src/html/user/user_list.html",function(b){$("#content").html(b);$.each(a,function(c,d){$.get("src/html/user/user_list_row.html",function(e){$("#user_list .table tbody").append(Mustache.render($(e).html(),d))})})})}).fail(function(a){console.log("Fejl i User REST")})}function generateInitials(b){var d="";splitName=b.split(" ");if(splitName.length<3){for(var c=0;c<splitName.length;c++){d+=splitName[c].substring(0,2)}}else{d+=splitName[0].substring(0,1);var a;if(splitName.length==3){a=2}else{a=3}for(var c=splitName.length-a;c<splitName.length;c++){d+=splitName[c].substring(0,1)}}return d}function createUser(a){return $.ajax({url:"rest/user/create",type:"POST",contentType:"application/json",data:a})}function updateUser(a){return $.ajax({url:"rest/user/update",type:"PUT",contentType:"application/json",data:a})}function getUser(a){return $.ajax({url:"rest/user/read",type:"POST",data:a,contentType:"application/json"})}function getUserList(){return $.ajax({url:"rest/user/read_list",type:"GET",contentType:"application/json"})};